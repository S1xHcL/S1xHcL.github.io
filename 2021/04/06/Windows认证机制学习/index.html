<!DOCTYPE html>
<html lang="en">
    <!-- title -->




<!-- keywords -->




<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" >
    <meta name="author" content="S1xHcL">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="S1xHcL">
    
    <meta name="keywords" content="hexo,hexo-theme,hexo-blog">
    
    <meta name="description" content="">
    <meta name="description" content="0x00 本地认证本地认证基础知识在本地登录Windows的情况下，操作系统会将用户输入的密码作为凭证和系统中存储的密码进行验证 SAM文件存储路径为%SystemRoot%\system32\config\sam 在输入密码的过程中，会将密码进行加密为hash值，然后查找系统SAM文件中用户密码对应的hash值进行比较，如果相同，则证明认证成功，密码正确。  Windows本身不保存明文密码，只">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows认证机制学习">
<meta property="og:url" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="0x00 本地认证本地认证基础知识在本地登录Windows的情况下，操作系统会将用户输入的密码作为凭证和系统中存储的密码进行验证 SAM文件存储路径为%SystemRoot%\system32\config\sam 在输入密码的过程中，会将密码进行加密为hash值，然后查找系统SAM文件中用户密码对应的hash值进行比较，如果相同，则证明认证成功，密码正确。  Windows本身不保存明文密码，只">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/1.png">
<meta property="og:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/2.png">
<meta property="og:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/3.png">
<meta property="og:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/4.png">
<meta property="og:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/5.png">
<meta property="og:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/6.png">
<meta property="og:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/7.png">
<meta property="og:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/8.png">
<meta property="og:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/9.png">
<meta property="article:published_time" content="2021-04-06T13:05:57.000Z">
<meta property="article:modified_time" content="2021-04-17T16:17:50.369Z">
<meta property="article:author" content="S1xHcL">
<meta property="article:tag" content="Windows认证">
<meta property="article:tag" content="Kerberos">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/1.png">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    
    <title>Windows认证机制学习 · S1xHcL&#39;s Blog</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href= "/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <link rel="stylesheet" href= "/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href= "/assets/Sakamoto.ico" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script" />
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script" />
    <link rel="preload" href="/scripts/main.js" as="script" />
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
<meta name="generator" content="Hexo 5.3.0"></head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >S1xHcL&#39;s Blog.</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">Windows认证机制学习</a>
            </div>
    </div>
    
    <a class="home-link" href=/>S1xHcL's Blog.</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            Windows认证机制学习
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "Windows认证">Windows认证</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "Kerberos">Kerberos</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>Word count: <span class="post-count word-count">5.4k</span>Reading time: <span class="post-count reading-time">20 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2021/04/06</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <h1 id="0x00-本地认证"><a href="#0x00-本地认证" class="headerlink" title="0x00 本地认证"></a>0x00 本地认证</h1><h2 id="本地认证基础知识"><a href="#本地认证基础知识" class="headerlink" title="本地认证基础知识"></a>本地认证基础知识</h2><p>在本地登录<code>Windows</code>的情况下，操作系统会将用户输入的密码作为凭证和系统中存储的密码进行验证</p>
<p><code>SAM</code>文件存储路径为<code>%SystemRoot%\system32\config\sam</code></p>
<p>在输入密码的过程中，会将密码进行加密为<code>hash</code>值，然后查找系统<code>SAM</code>文件中用户密码对应的<code>hash</code>值进行比较，如果相同，则证明认证成功，密码正确。</p>
<blockquote>
<p>Windows本身不保存明文密码，只保留密码的 Hash</p>
</blockquote>
<h2 id="NTLM-Hash-与-NTLM"><a href="#NTLM-Hash-与-NTLM" class="headerlink" title="NTLM Hash 与 NTLM"></a>NTLM Hash 与 NTLM</h2><p>在<code>Windows</code>中，密码<code>Hash</code>称为<code>NTLM Hash</code>，其中NTLM全程为<code>NT LAN Manager</code></p>
<p><code>NTLM</code>是一种网络认证协议，与<code>NTLM Hash</code>的关系就是：NTLM网络认证协议是以NTLM Hash作为根本凭证进行认证的协议。</p>
<p>在本地认证的过程中，就是将用户输入的密码转换称<code>NTLM Hash</code>与<code>SAM</code>表中的<code>NTLM Hash</code>进行比较认证。</p>
<h2 id="NTLM-Hash的产生"><a href="#NTLM-Hash的产生" class="headerlink" title="NTLM Hash的产生"></a>NTLM Hash的产生</h2><p>假设密码为<code>admin</code>，产生流程为：系统将<code>admin</code>转换成十六进制，经过<code>Unicode</code>转换后，再使用<code>MD4</code>进行加密，最后得到<code>NTLM Hash</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin  -&gt; hex(16进制编码) &#x3D; 61646d696e</span><br><span class="line">61646d696e -&gt; Unicode &#x3D; 610064006d0069006e00</span><br><span class="line">610064006d0069006e00 -&gt; MD4 &#x3D; 209c6174da490caeb422f3fa5a7ae634</span><br></pre></td></tr></table></figure>
<h2 id="本地认证流程·"><a href="#本地认证流程·" class="headerlink" title="本地认证流程·"></a>本地认证流程·</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winlogon.exe -&gt; 用户输入 -&gt; lsass.exe -&gt; 认证</span><br></pre></td></tr></table></figure>
<p>每当用户注销、重启、锁屏后，操作系统会让<code>winlogon.exe</code>显示登录页面，在用户输入后将密码交给<code>lasses.exe</code>进程，这个进程中就会保存一份明文密码，将明文密码加密成<code>NTLM Hash</code>再和<code>SAM</code>数据库中的<code>Hash</code>值进行比较认证。</p>
<ul>
<li>Windows Logon Process（即winlogon.exe），是Windows NT 用户登录程序，用于管理用户登录和退出</li>
<li><code>lsass.exe</code>进程用于实现Windows安全策略（本地安全策略和登录策略）。我们平常说的抓密码就是导出<code>lasses.exe</code>内存中存储的明文密码。</li>
</ul>
<h2 id="LM-Hash"><a href="#LM-Hash" class="headerlink" title="LM Hash"></a>LM Hash</h2><p>在<code>NTLM</code>协议出现前，Windows认证协议为LM（LAN Manager）协议。</p>
<p><strong>LM协议和NTLM协议的认证机制相同，但是加密算法不同</strong></p>
<p>但<code>LM</code>协议不够安全，现在已经淘汰使用了</p>
<p><code>LM Hash</code>的产生流程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">将所有的小写字母转换成大写字母</span><br><span class="line"> - &gt; 123ABC  &#x2F;&#x2F;未达到7个字符</span><br><span class="line"> - 将密码转化成16进制，分为两组，填充为14个字符，空余位使用0x00字符填补</span><br><span class="line"> - 31323341424300000000000000</span><br><span class="line"> - 将密码分割为两组7个字节的块</span><br><span class="line"> - 31323341424300 00000000000000</span><br><span class="line"> - 将每组转化为比特流，不足56Bit则在左边补零</span><br><span class="line"> - 31323341424300 -&gt; 110001001100100011001101000001010000100100001100000000 -&gt; 00110001001100100011001101000001010000100100001100000000</span><br><span class="line"> - 将比特流按照7比特一组，分出8组，末尾补0</span><br><span class="line"></span><br><span class="line">由于后者都为0，结果可想而知，那就都是0;</span><br><span class="line"> - 将每组比特流转换为16进制作为被加密的值，使用DES加密，字符串&quot;KGS!@#$%&quot;为Key(0x4B47532140232425)，得到8个结果，将每个结果转换为16进制。</span><br><span class="line"> - -&gt; 00110000100110001000110001101000000101000001001000001100 00000000</span><br><span class="line"> - -&gt;30988C6814120C00 -&gt; DES(30988C6814120C00) -&gt; 48-D7-EB-91- 2F-5E-69-7C</span><br><span class="line"> - 由于我们的密码不超过7字节，所以后面的一半是固定的:</span><br><span class="line"> - AA-D3-B4-35-B5-14-04-EE</span><br><span class="line"> - 连接两个DES加密字符串。这是LM哈希</span><br><span class="line"> - 48-D7-EB-91-2F-5E-69-7C-AA-D3-B4-35-B5-14-04-EE</span><br></pre></td></tr></table></figure>
<p>在上面的<code>LM Hash</code>产生过程中，脆弱点就在于DES的Key<code>KGS!@#$%</code>是固定的，也就是说，有了Key就能够解出原文。并且通过<code>LM Hash</code>的特征判断原文的密码长度是否超过7位字符</p>
<h1 id="0x01-网络认证"><a href="#0x01-网络认证" class="headerlink" title="0x01 网络认证"></a>0x01 网络认证</h1><p>在内网渗透中，经常遇到工作组环境，而工作组环境是一个逻辑 上的网络环境(工作区)，隶属于工作组的机器之间无法互相建 立一个完美的信任机制，只能点对点，是比较落后的认证方式， 没有信托机构。</p>
<p>假设A主机与B主机属于同一个工作组环境，A想访问B主机上的资料，需要将一个存在于B主机上的账户凭证发送至B主机，经过认证才能够访问B主机上的资源。</p>
<p>我们接触比较多的SMB共享文件的案例，SMB的默认端口是445。</p>
<p>早期SMB协议在网络上传输明文口令。后来出现<code>LAN Manager</code>,<code>Challenge/Response</code> 验证机制，简称<code>LM</code>，它是如此简单以至很容易就被破解，现在又有了<code>NTLM</code>以及<code>Kerberos</code>。</p>
<h2 id="NTLM协议"><a href="#NTLM协议" class="headerlink" title="NTLM协议"></a>NTLM协议</h2><p>NTLM协议是一种网络认证协议，它是基于挑战<code>Chalenge</code>/相应<code>Response</code>认证机制的一种认证模式。</p>
<h2 id="Chalenge-Response"><a href="#Chalenge-Response" class="headerlink" title="Chalenge/Response"></a>Chalenge/Response</h2><p>NTLM协议认证分为三步：</p>
<ol>
<li>协商</li>
<li>质询</li>
<li>验证</li>
</ol>
<p><strong>协商</strong>: 主要用户确认双方协议版本</p>
<p>客户端主要再这一步向服务器确定协议的版本，是<code>v1</code>还是<code>v2</code>或者其他认证方式</p>
<p><strong>质询</strong>：就是挑战<code>Chalenge</code>/相应<code>Response</code>认真机制起作用的范畴</p>
<p><strong>验证</strong>：验证主要是再质询完成后，验证结果，是认证的最后一步</p>
<p>质询的完整过程：</p>
<ol>
<li>客户端向服务器端发送用户信息(用户名)请求。</li>
<li>服务器接受到请求，生成一个16位的随机数，被称之为<code>Challenge</code>， 使用登录用户名对应的<code>NTLM Hash</code>加密Challenge(16位随机字符)， 生成<code>Challenge1</code>。同时，生成<code>Challenge1</code>后，将Challenge(16位随机 字符)发送给客户端。// Net NTLM Hash = Challenge1 = NTLM Hash(Challenge)</li>
<li>客户端接受到<code>Challenge</code>后，使用将要登录到账户对应的<code>NTLM Hash</code>加密<code>Challenge</code>生成<code>Response</code>，然后将<code>Response</code>发送至服务器端。</li>
<li>服务器端收到客户端的<code>Response</code>后，比对<code>Chanllenge1</code>与<code>Response</code>是否相等，如果相等则通过认证。</li>
</ol>
<p>使用另外一种方式解读：</p>
<ol>
<li><code>Server</code>接收到<code>Client</code>发送的用户名后，判断本地账户列 表是否有用户名<code>share_user</code></li>
</ol>
<ul>
<li>如果没有，返回认证失败</li>
<li>如果有，生成<code>Chanllenge</code>，并且从本地查找<code>share_user</code>对应的<code>NTLM Hash</code>，使用<code>NTLM Hash</code>加密<code>Chanllenge</code>，生成一个<code>Net-NTLM Hash</code>存在内存中，并将<code>Chanllenge</code>发送给<code>Client</code></li>
</ul>
<ol start="2">
<li><code>Client</code>接收到<code>Chanllenge</code>后，将自己提供的<code>share_user</code>的密码转换为<code>NTLM Hash</code>，使用<code>NTLM Hash</code>加密<code>Chanllenge</code>，这个结果叫<code>Response</code>，表现形式是<code>Net-NTLM Hash</code>，最后将<code>Response</code>发送给<code>Server</code></li>
<li><code>Server</code>接收到<code>Client</code>发送的<code>Response</code>，将<code>Response</code>与之前的<code>Net-NTLM Hash</code>进行比较，如果相等，则认证通过</li>
</ol>
<p><strong>注意：</strong></p>
<ol>
<li><code>Chanllenge</code>是<code>Server</code>产生的一个16字节的随机数，每次认证都不同</li>
<li><code>Response</code>的表现形式是<code>Net-NTLM Hash</code>，它是由客户端提供的密码<code>Hash</code>加密<code>Server</code>返回的<code>Chanllenge</code>产生的结果</li>
</ol>
<p><img src="1.png"></p>
<h2 id="NTLM-V2协议"><a href="#NTLM-V2协议" class="headerlink" title="NTLM V2协议"></a>NTLM V2协议</h2><p><code>NTLM V1</code>与<code>NTLM V2</code>最显著的区别就是<code>Challenge</code>与加密算法不同，共同点就是加密的原料都是<code>Challenge</code></p>
<p>不同点：</p>
<ul>
<li>Challage：<code>NTLM v1</code>的<code>Challenge</code>有8位，<code>NTLM v2</code>的<code>Challenge</code>为16位</li>
<li>Net-NTLM Hash：<code>NTLM v1</code>的主要加密算法是DES，<code>NTLM v2</code>的主要加密算法是HMAC-MD5</li>
</ul>
<h2 id="Pass-The-Hash"><a href="#Pass-The-Hash" class="headerlink" title="Pass The Hash"></a>Pass The Hash</h2><p>在内网渗透中，我们经常会需要抓取管理员的密码、NTLM Hash，通过搜集这些信息有助于我们扩大战果，尤其是在域环境下</p>
<ul>
<li>什么是哈希传递</li>
</ul>
<p>哈希传递是能够在不需要账户明文密码的情况下完成认证的一个技术。</p>
<ul>
<li>哈希传递的作用</li>
</ul>
<p>解决了我们渗透中获取不到明文密码、破解不了NTLM Hash而又想扩大战果的问题</p>
<p><strong>Pass The Hash 使用条件</strong></p>
<ul>
<li>哈希传递需要被认证的主机能够访问到服务器</li>
<li>哈希传递需要被传递认证的用户名</li>
<li>哈希传递需要被传递认证用户的<code>NTLM Hash</code></li>
</ul>
<p>要完成一个NTLM认证，第一步需要客户端将自己要参与认证的 用户名发送至服务器端，等待服务器端给出的Challenge</p>
<p>其实哈希传递就是使用用户名对应的NTLM Hash将服务器给出的 Chanllenge加密，生成一个Response，来完成认证。</p>
<p>Pass The Hash能够完成一个不需要输入密码的NTLM协议认证流程，所以不算是一个漏洞，算是一个技巧。</p>
<p>Pass The Hash工具：</p>
<ul>
<li>Smbmap</li>
<li>CrackMapExec</li>
<li>Smbexec</li>
<li>Metasploit</li>
</ul>
<h1 id="Kerberos域认证"><a href="#Kerberos域认证" class="headerlink" title="Kerberos域认证"></a>Kerberos域认证</h1><h2 id="Active-Directory-活动目录-概念"><a href="#Active-Directory-活动目录-概念" class="headerlink" title="Active Directory(活动目录)概念"></a>Active Directory(活动目录)概念</h2><p>Windows提供了为企业管理资产、服务、网络对象进行组织化的管理，这非常符合企业架构的管理模式。而承载这些管理机制的就是活动目录服务。如果要搭建一个域，就需要安装活动目录服务。</p>
<p>活动目录服务以域名来划分域的边界，域外就不属于管理范围了，也就是说，一个域对应一个域名，域之间也可以相互信任。</p>
<ul>
<li><code>Active Directory</code>存储了有关网络对象的信息，并且让管理员和用 户能够轻松地查找和使用这些信息。<code>Active Directory</code>使用了一种 结构化的数据存储方式，并以此作为基础对目录信息进行合乎逻 辑的分层组织。</li>
<li>网络对象分为:用户、用户组、计算机、域、组织单位以及安全策略等。</li>
</ul>
<h2 id="Active-Direectory-活动目录-功能"><a href="#Active-Direectory-活动目录-功能" class="headerlink" title="Active Direectory(活动目录)功能"></a>Active Direectory(活动目录)功能</h2><ul>
<li>服务器及客户端计算机管理：管理服务器及客户端计算机账户，所有服务器及客户端计算机加入域管理并实施组策略。</li>
<li>用户服务：管理用户域账户、用户信息、企业通讯录(与电子邮件系统集成)、用户组管理、用户身份认证、用户授权管理等，按省实施组管理策略。</li>
<li>资源管理：管理打印机、文件共享服务等网络资源。</li>
<li>桌面配置：系统管理员可以集中的配置各种桌面配置策略，如: 用户使用域中资源权限限制、界面功能的限制、应用程序执行特 征限制、网络连接限制、安全配置限制等。</li>
<li>应用系统支撑：支持财务、人事、电子邮件、企业信息门户、办 公自动化、补丁管理、防病毒系统等各种应用系统。</li>
</ul>
<p>在域中，网络对象可以相互访问，但是在真实情况中，需要对某些部门的计算机进行限制，例如：销售部门不能访问技术部门的服务器。</p>
<p>这个中间就需要<code>Kerberos认证协议</code>来验证网络对象间的权限。</p>
<h2 id="域认证体系-Kerberos"><a href="#域认证体系-Kerberos" class="headerlink" title="域认证体系 - Kerberos"></a>域认证体系 - Kerberos</h2><p><code>Kerberos</code>是一种网络认证协议，其设计目标是通过密钥系统为客户机 / 服务器应用程序提供强大的认证服务。该认证过程的实现不 依赖于主机操作系统的认证，无需基于主机地址的信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包可以被任意地读取、修改和插入数据。在以上情况下，<code>Kerberos</code>作为一种可信任的第三方认证服务，是通过传统的密码技术(如:共享 密钥)执行认证服务的。</p>
<h2 id="域认证所参与的角色"><a href="#域认证所参与的角色" class="headerlink" title="域认证所参与的角色"></a>域认证所参与的角色</h2><p>Kerberos的标志是三只狗头，狗头分别代表以下角色：</p>
<ul>
<li>Client</li>
<li>Server</li>
<li>KDC(Key Distribution Center) = DC(Domain Controller)</li>
</ul>
<p>Kerberos认证协议的基础概念：</p>
<p>票据（Ticket）：是网络对象互相访问的凭证。<br>TGT（Ticket Granting Ticket）：入场券，通过入场券能够获得票据，是一种临时凭证的存在。</p>
<p><img src="2.png"></p>
<p>KDC负责管理票据、认证票据、分发票据，但是KDC不是一个独立的服务，它由以下服务组成：</p>
<ul>
<li>Authentication Service: 为client生成TGT的服务</li>
<li>Ticket Granting Service: 为client生成某个服务的ticket</li>
</ul>
<p>另外还需要介绍一个类似于本机SAM的一个数据库：AD，全称叫<code>Account Database</code>，存储所有client的白名单，只有存在于白名单的client才能顺利申请到TGT。</p>
<p>从物理层面看，AD与KDC均为域控制器(Domain Controller)。</p>
<h2 id="域认证粗略流程"><a href="#域认证粗略流程" class="headerlink" title="域认证粗略流程"></a>域认证粗略流程</h2><ol>
<li>client向kerberos服务请求，希望获取访问server的权限。kerberos得到了这个消息，首先得判断client是否是可信赖的，也就是白名单黑名单的说法。这就是AS服务完成的工作，通过在AD中存储黑名单和白名单来区分client。成功后，返回AS返回TGT给client。</li>
<li>client得到了TGT后，继续向kerberos请求，希望获取访问 server的权限。kerberos又得到了这个消息，这时候通过client 消息中的TGT，判断出了client拥有了这个权限，给了client访问server的权限ticket。</li>
<li>client得到ticket后，终于可以成功访问server。这个ticket只是针对这个server，其他server需要向TGS申请。</li>
</ol>
<h2 id="域认证"><a href="#域认证" class="headerlink" title="域认证"></a>域认证</h2><p><img src="3.png"></p>
<p>首先，客户端需要发送自己的身份信息到KDC，身份信息中起码包含用户名，KDC根据用户名在AD中寻找是否在白名单中，然后根据用户名提取到对应的NTLM Hash。</p>
<p>KDC此时生成一个随机字符串，叫Session Key，使用用户名对应的NTLM Hash加密Session Key，作为AS数据，使用KDC中某个用户的NTLM Hash加密Session Key和客户端的信息，生成TGT。</p>
<ul>
<li>Session Key用于客户端向TGS服务通信。</li>
<li>域内所有网络对象的凭证都在AD中保存</li>
<li>KDC中某个用户指的是krbtgt</li>
</ul>
<p>数据结构：</p>
<p><img src="4.png"></p>
<p><img src="5.png"></p>
<p>其中，TGT的到期时间为8小时，如果超过了8小时，还需要重新申请TGT，不能之间进入下一步获取Ticket。</p>
<p>Kerberos是一个假设网络环境不安全的情况下能够正常进行认证工作的协议。</p>
<p>第一步中，KDC返回的TGT客户端是无法解密的，因为它没有KDC Hash，如果有，我们就可以伪造黄金票据，这个是后话了。</p>
<p><img src="6.png"></p>
<p>第二步客户端需要提供<code>TGT</code>与第一步中使用自己<code>NTLM Hash</code>解密出来的Session Key加密的客户端信息跟时间戳。</p>
<p>如果假设这个数据被中间人窃取到，也无法在段时间内破解，因为<code>KDC</code>会校验时间戳。</p>
<p><code>KDC</code>接到<code>TGT</code>与其他内容后，会首先解密<code>TGT</code>，只有<code>KDC</code>可以解密<code>TGT</code>，从<code>TGT</code>中提取到<code>Session Key</code>，再使用<code>Session Key</code>解密其他内容，解密出来的内容同<code>TGT</code>中的信息进行校验来确认客户端是否受信。</p>
<p>验证通过后，就会生成一个新的<code>Session Key</code>，我们称之为<code>Server Session Key</code>，这个<code>Server Session Key</code>主要用于和服务器进行通信。同时还会生成一个<code>Ticket</code>，也就是最后的票据了。</p>
<p>Ticket组成如下：</p>
<p><img src="7.png"></p>
<p>Server Hash：这个Hash是在AD中服务器计算机的NTLM Hash。</p>
<p><img src="8.png"></p>
<p>在第三步里，客户端向服务器请求，需要提供<code>Ticket</code>，<code>Server Session Key</code>加密的客户端信息与时间戳。</p>
<ul>
<li>Ticket客户端无法解密</li>
<li>服务器端通过解密<code>Ticket</code>解密<code>Server Session Key(Client info + Timestamp)</code></li>
<li>比较时间长度</li>
</ul>
<p>校验通过后，认证成功，该票据会一直存在客户端内存中。</p>
<h2 id="域认证流程"><a href="#域认证流程" class="headerlink" title="域认证流程"></a>域认证流程</h2><p><img src="9.png"></p>
<ol>
<li>AS - REQ</li>
</ol>
<p>Client 向 KDC 发起请求明文密码将会被加密为 hash时间戳使用 Client hash 进行加密然后作为认证票据TGT请求AS-REQ中的认证因子发送给KDC。</p>
<ol start="2">
<li>AS - REP</li>
</ol>
<p>KDC 使用 Client hash 进行解密如果结果正确就返回用 krbtgt hash 加密的 TGT 票据。TGT 里面包含 PACPAC 包含 Client 的 sidClient 所在的组。</p>
<ol start="3">
<li>TGS - REQ</li>
</ol>
<p>当 Client 请求票据授予服务TGS票据时用户需要向 KDC 展示TGT数据。KDC 会打开票据进行校验和检查。如果 KDC 能够打开票据并能通过校验和检查那么会认为 TGT 为有效票据。此时 TGT 中的数据会被复制以创建 TGS 票据。</p>
<ol start="4">
<li>TGS - REP</li>
</ol>
<p>KDC 使用目标服务账户的 hash 对 TGS 票据进行加密然后将结果发送给 Client。(这一步不管用户有没有访问服务的权限只要TGT 正确就返回 TGS 票据)</p>
<ol start="5">
<li>AP - REQ</li>
</ol>
<p>Client 访问目标服务并发送 TGS 票据去请求服务。</p>
<ol start="6">
<li>AP - REP</li>
</ol>
<p>服务使用自己的 hash 解密 TGS 票据。如果解密正确就拿着 PAC 去 KDC 查询 Client 有没有访问权限KDC 解密 PAC。获取 Client的 sid以及所在的组再根据该服务的 ACL判断 Client 是否有访问服务的权限。</p>
<h2 id="白银票据（Silver-Tickets）"><a href="#白银票据（Silver-Tickets）" class="headerlink" title="白银票据（Silver Tickets）"></a>白银票据（Silver Tickets）</h2><p>白银票据特点：</p>
<ol>
<li>不需要于<code>KDC</code>进行交互</li>
<li>需要目标服务的<code>NTLM Hash</code></li>
</ol>
<p>在第三步认证中的<code>Ticket</code>的组成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ticket &#x3D; Server Hash(Server Session Key + Client Info + End Time)</span><br></pre></td></tr></table></figure>
<p>当拥有<code>Server Hash</code>时，我们就可以伪造一个不经过<code>KDC</code>认证的一个<code>Ticket</code>。</p>
<p>PS: Server Session Key在未发送Ticket之前，服务器是不知道Server Session Key是什么的。 所以，一切凭据都来源于Server Hash。</p>
<h2 id="伪造白银票据（Silver-Tickets）"><a href="#伪造白银票据（Silver-Tickets）" class="headerlink" title="伪造白银票据（Silver Tickets）"></a>伪造白银票据（Silver Tickets）</h2><ol>
<li>导出<code>Server Hash</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\files&gt;mimikatz.exe &quot;privilege::debug” &quot;sekurlsa::logonpasswords&quot; &quot;exit&quot; &gt; log.txt</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>伪造票据</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz “kerberos::golden &#x2F;domain:&lt;域名&gt; &#x2F;sid:&lt;域 SID&gt; &#x2F;target:&lt;目标服务器主机名&gt; &#x2F;service:&lt;服务类型&gt; &#x2F;rc4:&lt;NTLM Hash&gt; &#x2F;user:&lt;用户名&gt; &#x2F;ptt&quot; exit</span><br></pre></td></tr></table></figure>
<p>默认服务：</p>
<p>由于白银票据需要目标服务器的<code>Hash</code>，所以没办法生成对应域内所有服务器的票据，也不能通过<code>TGT</code>申请。因此只能针对服务器上的某些服务去伪造，伪造的服务类型列表如下:</p>
<table>
<thead>
<tr>
<th align="center">服务注释</th>
<th align="center">服务名</th>
</tr>
</thead>
<tbody><tr>
<td align="center">WMI</td>
<td align="center">HOST、RPCSS</td>
</tr>
<tr>
<td align="center">Powershell Remoteing</td>
<td align="center">HOST、HTTP</td>
</tr>
<tr>
<td align="center">WinRM</td>
<td align="center">HOST、HTTP</td>
</tr>
<tr>
<td align="center">Scheduled Tasks</td>
<td align="center">HOST</td>
</tr>
<tr>
<td align="center">LDAP 、DCSync</td>
<td align="center">LDAP</td>
</tr>
<tr>
<td align="center">Windows File Share (CIFS)</td>
<td align="center">CIFS</td>
</tr>
<tr>
<td align="center">Windows Remote ServerAdministration Tools</td>
<td align="center">RPCSS、LDAP、CIFS</td>
</tr>
</tbody></table>
<h2 id="白银票据（Silver-Tickets）防御"><a href="#白银票据（Silver-Tickets）防御" class="headerlink" title="白银票据（Silver Tickets）防御"></a>白银票据（Silver Tickets）防御</h2><ol>
<li>尽量保证服务器凭证不被窃取</li>
<li>开启PAC (Privileged Attribute Certificate) 特权属性证书保护 功能，PAC主要是规定服务器将票据发送给kerberos服务，由 kerberos服务验证票据是否有效。</li>
</ol>
<p>开启方式：</p>
<p>将注册表中<code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Kerberos\Parameters</code>中的<code>ValidateKdcPacSignature</code>设置为1。</p>
<h2 id="黄金票据（Golden-Tickets）"><a href="#黄金票据（Golden-Tickets）" class="headerlink" title="黄金票据（Golden Tickets）"></a>黄金票据（Golden Tickets）</h2><p>黄金票据的特点：</p>
<ol>
<li>需要于<code>DC</code>通信</li>
<li>需要<code>krbtgt</code>用户的<code>hash</code></li>
</ol>
<p>这里的<code>krbtgt hash</code>就是之前讲的<code>KDC Hash</code></p>
<h2 id="黄金票据（Golden-Tickets）伪造"><a href="#黄金票据（Golden-Tickets）伪造" class="headerlink" title="黄金票据（Golden Tickets）伪造"></a>黄金票据（Golden Tickets）伪造</h2><p>伪造票据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mimikatz &quot;kerberos::golden &#x2F;domain:&lt;域名&gt; &#x2F;sid:&lt;域SID&gt; &#x2F;rc4:&lt;KRBTGT NTLM Hash&gt; &#x2F;user:&lt;任意用户名&gt; &#x2F;ptt&quot; exit</span><br></pre></td></tr></table></figure>
<h2 id="Tickets-总结"><a href="#Tickets-总结" class="headerlink" title="Tickets 总结"></a>Tickets 总结</h2><ul>
<li>黄金票据:从攻击面来看，获取krbtgt用户的hash后，可以在域中进行持久性的隐藏，并且日志无法溯源，但是需要拿到DC权限， 使用黄金票据能够在一个域环境中长时间控制整个域。</li>
<li>从防御角度来看，需要经常更新krbtgt的密码，才能够使得原有的票据失效。最根本的办法是不允许域管账户登录其他服务器。</li>
<li>白银票据:从攻击面来看，伪造白银票据的难度比伪造黄金票据的难度较小，因为一个域中的服务器如果对外的话，非常容易被入侵， 并且容易被转储Server。</li>
<li>从防御角度来看，需要开启PAC认证，但这会降低认证效率，增加DC的负担，最根本的还是要加固服务器本身对外的服务。</li>
</ul>
<h1 id="Windows-Access-Token"><a href="#Windows-Access-Token" class="headerlink" title="Windows Access Token"></a>Windows Access Token</h1><h2 id="Windows-Access-Token-简介"><a href="#Windows-Access-Token-简介" class="headerlink" title="Windows Access Token 简介"></a>Windows Access Token 简介</h2><p><code>Windows Token</code>其实叫<code>Access Token(访问令牌)</code>，它是一个描述进程或者线程安全上下文的一个对象。不同的用户登录计算机后，都会生成一个<code>Access Token</code>，这个<code>Token</code>在用户创建进程或者线程时会被使用，不断的拷贝，这也就解释了A用户创建一个进程而该进程没有B用户的权限。</p>
<p><code>Access Token</code>种类：</p>
<ul>
<li>主令牌</li>
<li>模拟令牌</li>
</ul>
<p>一般情况下，用户双击运行一个程序，都会拷贝<code>explorer.exe</code>的<code>Access Token</code>。</p>
<p>当用户注销后，系统将会使主令牌切换为模拟令牌，不会将令牌清除，只有在重启机器后才会清除。</p>
<h2 id="Windows-Access-Token-组成"><a href="#Windows-Access-Token-组成" class="headerlink" title="Windows Access Token 组成"></a>Windows Access Token 组成</h2><ul>
<li>用户账户的安全标识符（SID）</li>
<li>用户所属的组SID</li>
<li>用于标识当前登录会话的登录SID</li>
<li>用户或用户组所拥有的权限列表</li>
<li>所有者SID</li>
<li>主要组的SID</li>
<li>访问控制列表</li>
<li>访问令牌的来源</li>
<li>令牌是主要令牌还是模拟令牌</li>
<li>限制SID的可选列表</li>
<li>目前的模拟等级</li>
<li>其他统计数据</li>
</ul>
<h2 id="Windows-Access-Token-SID（Security-Identifiers）安全标识符"><a href="#Windows-Access-Token-SID（Security-Identifiers）安全标识符" class="headerlink" title="Windows Access Token - SID（Security Identifiers）安全标识符"></a>Windows Access Token - SID（Security Identifiers）安全标识符</h2><p>安全标识符是一个唯一的字符串，它可以代表一个账户、一个用户组、或者是一次登录。通常它还有一个SID固定列表，例如Everyone这种已经内置的账户，默认拥有固定的SID。</p>
<p>SID的表现形式：</p>
<ul>
<li>域SID-用户ID</li>
<li>计算机SID-用户ID</li>
<li>SID列表都会存储在域控的AD或者计算机本地账户数据库中。</li>
</ul>
<h2 id="Windows-Access-Token产生过程"><a href="#Windows-Access-Token产生过程" class="headerlink" title="Windows Access Token产生过程"></a>Windows Access Token产生过程</h2><p>每个进程创建时都会根据登录会话权限由LSA(Local Security Authority)分配一个Token(如果CreaetProcess时自己指定了 Token, LSA会用该Token，否则就用父进程Token的一份拷贝。</p>
<h2 id="Windows-Access-Token令牌假冒实战"><a href="#Windows-Access-Token令牌假冒实战" class="headerlink" title="Windows Access Token令牌假冒实战"></a>Windows Access Token令牌假冒实战</h2><p><strong>当用户注销后，系统将会使主令牌切换为模拟令牌，不会将令牌清除，只有在重启机器后才会清除。</strong></p>
<p>可以使用多种工具查看目前系统上存在的模拟令牌：</p>
<ul>
<li>Incognito</li>
<li>Powershell - Invoke-TokenManipulation.ps1</li>
<li>Cobalt Strike - steal_token</li>
</ul>
<h2 id="Windows-Access-Token令牌假冒防御"><a href="#Windows-Access-Token令牌假冒防御" class="headerlink" title="Windows Access Token令牌假冒防御"></a>Windows Access Token令牌假冒防御</h2><p>禁止Domain Admins登录对外且未做安全加固的服务器，因为一旦服务器被入侵，域管理员的令牌可能会被攻击者假冒，从控制DC。</p>
<p>如果想清除假冒，重启服务器即可。</p>
<h1 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h1><p><a target="_blank" rel="noopener" href="https://payloads.online/archivers/2018-11-30/1">彻底理解Windows认证 - 议题解读</a></p>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>Author：<a href="https://s1xhcl.github.io">S1xHcL</a>
            <p>原文链接：<a href="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/">https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/</a>
            <p>发表日期：<a href="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/">April 6th 2021, 9:05:57 pm</a>
            <p>更新日期：<a href="https://s1xhcl.github.io/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/">April 18th 2021, 12:17:50 am</a>
            <p>版权声明：本文采用<a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/2021/04/08/2021-HW/" title= "2021-HW">
                    <div class="nextTitle">2021-HW</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2021/04/01/%E4%B8%80%E6%AC%A1%E7%AE%80%E5%8D%95%E7%9A%84%E6%9D%80%E7%8C%AA%E7%9B%98getshell/" title= "一次简单的杀猪盘getshell">
                    <div class="prevTitle">一次简单的杀猪盘getshell</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!-- gitalk评论 -->

    <!-- utteranc评论 -->

    <!-- partial('_partial/comment/changyan') -->
    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="https://github.com/S1xHcL" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x00-%E6%9C%AC%E5%9C%B0%E8%AE%A4%E8%AF%81"><span class="toc-number">1.</span> <span class="toc-text">0x00 本地认证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%AE%A4%E8%AF%81%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.</span> <span class="toc-text">本地认证基础知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM-Hash-%E4%B8%8E-NTLM"><span class="toc-number">1.2.</span> <span class="toc-text">NTLM Hash 与 NTLM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM-Hash%E7%9A%84%E4%BA%A7%E7%94%9F"><span class="toc-number">1.3.</span> <span class="toc-text">NTLM Hash的产生</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B%C2%B7"><span class="toc-number">1.4.</span> <span class="toc-text">本地认证流程·</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LM-Hash"><span class="toc-number">1.5.</span> <span class="toc-text">LM Hash</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-%E7%BD%91%E7%BB%9C%E8%AE%A4%E8%AF%81"><span class="toc-number">2.</span> <span class="toc-text">0x01 网络认证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.1.</span> <span class="toc-text">NTLM协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Chalenge-Response"><span class="toc-number">2.2.</span> <span class="toc-text">Chalenge&#x2F;Response</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NTLM-V2%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.3.</span> <span class="toc-text">NTLM V2协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pass-The-Hash"><span class="toc-number">2.4.</span> <span class="toc-text">Pass The Hash</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kerberos%E5%9F%9F%E8%AE%A4%E8%AF%81"><span class="toc-number">3.</span> <span class="toc-text">Kerberos域认证</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Active-Directory-%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95-%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">Active Directory(活动目录)概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Active-Direectory-%E6%B4%BB%E5%8A%A8%E7%9B%AE%E5%BD%95-%E5%8A%9F%E8%83%BD"><span class="toc-number">3.2.</span> <span class="toc-text">Active Direectory(活动目录)功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E8%AE%A4%E8%AF%81%E4%BD%93%E7%B3%BB-Kerberos"><span class="toc-number">3.3.</span> <span class="toc-text">域认证体系 - Kerberos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E8%AE%A4%E8%AF%81%E6%89%80%E5%8F%82%E4%B8%8E%E7%9A%84%E8%A7%92%E8%89%B2"><span class="toc-number">3.4.</span> <span class="toc-text">域认证所参与的角色</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E8%AE%A4%E8%AF%81%E7%B2%97%E7%95%A5%E6%B5%81%E7%A8%8B"><span class="toc-number">3.5.</span> <span class="toc-text">域认证粗略流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E8%AE%A4%E8%AF%81"><span class="toc-number">3.6.</span> <span class="toc-text">域认证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%9F%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B"><span class="toc-number">3.7.</span> <span class="toc-text">域认证流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%EF%BC%88Silver-Tickets%EF%BC%89"><span class="toc-number">3.8.</span> <span class="toc-text">白银票据（Silver Tickets）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%AA%E9%80%A0%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%EF%BC%88Silver-Tickets%EF%BC%89"><span class="toc-number">3.9.</span> <span class="toc-text">伪造白银票据（Silver Tickets）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BD%E9%93%B6%E7%A5%A8%E6%8D%AE%EF%BC%88Silver-Tickets%EF%BC%89%E9%98%B2%E5%BE%A1"><span class="toc-number">3.10.</span> <span class="toc-text">白银票据（Silver Tickets）防御</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE%EF%BC%88Golden-Tickets%EF%BC%89"><span class="toc-number">3.11.</span> <span class="toc-text">黄金票据（Golden Tickets）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%84%E9%87%91%E7%A5%A8%E6%8D%AE%EF%BC%88Golden-Tickets%EF%BC%89%E4%BC%AA%E9%80%A0"><span class="toc-number">3.12.</span> <span class="toc-text">黄金票据（Golden Tickets）伪造</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Tickets-%E6%80%BB%E7%BB%93"><span class="toc-number">3.13.</span> <span class="toc-text">Tickets 总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Windows-Access-Token"><span class="toc-number">4.</span> <span class="toc-text">Windows Access Token</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Access-Token-%E7%AE%80%E4%BB%8B"><span class="toc-number">4.1.</span> <span class="toc-text">Windows Access Token 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Access-Token-%E7%BB%84%E6%88%90"><span class="toc-number">4.2.</span> <span class="toc-text">Windows Access Token 组成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Access-Token-SID%EF%BC%88Security-Identifiers%EF%BC%89%E5%AE%89%E5%85%A8%E6%A0%87%E8%AF%86%E7%AC%A6"><span class="toc-number">4.3.</span> <span class="toc-text">Windows Access Token - SID（Security Identifiers）安全标识符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Access-Token%E4%BA%A7%E7%94%9F%E8%BF%87%E7%A8%8B"><span class="toc-number">4.4.</span> <span class="toc-text">Windows Access Token产生过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Access-Token%E4%BB%A4%E7%89%8C%E5%81%87%E5%86%92%E5%AE%9E%E6%88%98"><span class="toc-number">4.5.</span> <span class="toc-text">Windows Access Token令牌假冒实战</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows-Access-Token%E4%BB%A4%E7%89%8C%E5%81%87%E5%86%92%E9%98%B2%E5%BE%A1"><span class="toc-number">4.6.</span> <span class="toc-text">Windows Access Token令牌假冒防御</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">引用</span></a></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 46
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2024 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">06/02</span><a class="archive-post-title" href= "/2024/06/02/ThinkPHP-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/" >ThinkPHP 命令执行代码审计学习</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2023 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/16</span><a class="archive-post-title" href= "/2023/03/16/Nacos-%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" >Nacos 身份认证绕过漏洞复现</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/07</span><a class="archive-post-title" href= "/2023/02/07/PHPYun%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" >PHPYun代码审计</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2022 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/29</span><a class="archive-post-title" href= "/2022/12/29/ThinkPHP-%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" >ThinkPHP 代码审计学习记录</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/29</span><a class="archive-post-title" href= "/2022/12/29/ThinkPHP-%E6%B3%A8%E5%85%A5%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/ThinkPHP-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" >ThinkPHP 代码审计学习记录</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/16</span><a class="archive-post-title" href= "/2022/12/16/yakit%E4%B9%8B%E7%BC%96%E5%86%99poc/" >yakit之编写poc</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/18</span><a class="archive-post-title" href= "/2022/10/18/CNVD-2022-42853-%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" >CNVD-2022-42853-漏洞分析</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/18</span><a class="archive-post-title" href= "/2022/10/18/PHP-Audit-Day12-%E8%AF%AF%E7%94%A8htmlentities%E5%87%BD%E6%95%B0%E5%BC%95%E5%8F%91%E7%9A%84%E6%BC%8F%E6%B4%9E/" >PHP-Audit Day12 误用htmlentities函数引发的漏洞</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/11</span><a class="archive-post-title" href= "/2022/10/11/PHP-Audit-Day11-unserialize%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" >PHP-Audit Day11 unserialize反序列化漏洞</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/30</span><a class="archive-post-title" href= "/2022/04/30/Apache-Struts%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%AD%A6%E4%B9%A0-S2-062/" >Apache Struts漏洞分析学习-S2-062</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/10</span><a class="archive-post-title" href= "/2022/04/10/PHP-Audit-Day10-%E7%A8%8B%E5%BA%8F%E6%9C%AA%E6%81%B0%E5%BD%93exit%E5%AF%BC%E8%87%B4%E7%9A%84%E9%97%AE%E9%A2%98/" >PHP-Audit Day10 程序未恰当exit导致的问题</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/03</span><a class="archive-post-title" href= "/2022/04/03/PHP-Audit-Day09-str-replace-%E5%87%BD%E6%95%B0%E8%BF%87%E6%BB%A4%E4%B8%8D%E5%BD%93/" >PHP-Audit-Day09-str-replace-函数过滤不当</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2021 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/01</span><a class="archive-post-title" href= "/2021/11/01/%E6%9F%A5%E6%89%BE-spring-heapdump-%E4%B8%AD%E7%9A%84%E5%AF%86%E7%A0%81%E6%98%8E%E6%96%87/" >查找 spring heapdump 中的密码明文</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/22</span><a class="archive-post-title" href= "/2021/10/22/Pentest-tips-%E6%94%B6%E9%9B%86/" >Pentest-tips 收集</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/16</span><a class="archive-post-title" href= "/2021/10/16/PHP-Audit-Day08-preg-replace%E5%87%BD%E6%95%B0%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" >PHP-Audit Day08 preg_replace函数之命令执行</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/14</span><a class="archive-post-title" href= "/2021/10/14/PHP-Audit-Day07-parse-str%E5%87%BD%E6%95%B0%E7%BC%BA%E9%99%B7/" >PHP-Audit Day07 parse_str函数缺陷</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/12</span><a class="archive-post-title" href= "/2021/10/12/PHP-Audit-Day06-%E6%AD%A3%E5%88%99%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%BD%93%E5%AF%BC%E8%87%B4%E7%9A%84%E8%B7%AF%E5%BE%84%E7%A9%BF%E8%B6%8A%E9%97%AE%E9%A2%98/" >PHP-Audit Day06 正则使用不当导致的路径穿越问题</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/10</span><a class="archive-post-title" href= "/2021/10/10/PHP-Audit-Day05-escapeshellarg%E4%B8%8Eescapeshellcmd%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%BD%93/" >PHP-Audit Day05 escapeshellarg与escapeshellcmd使用不当</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/06</span><a class="archive-post-title" href= "/2021/10/06/PHP-Audit-Day04-strpos%E4%BD%BF%E7%94%A8%E4%B8%8D%E5%BD%93%E5%BC%95%E5%8F%91%E6%BC%8F%E6%B4%9E/" >PHP-Audit Day04 strpos使用不当引发漏洞</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/03</span><a class="archive-post-title" href= "/2021/10/03/PHP-Audit-Day03-%E5%AE%9E%E4%BE%8B%E5%8C%96%E4%BB%BB%E6%84%8F%E5%AF%B9%E8%B1%A1%E6%BC%8F%E6%B4%9E/" >PHP-Audit Day03 实例化任意对象漏洞</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/02</span><a class="archive-post-title" href= "/2021/10/02/PHP-Audit-Day02-filter-var-%E5%87%BD%E6%95%B0%E7%BC%BA%E9%99%B7/" >PHP-Audit Day02 filter_var()函数缺陷</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/01</span><a class="archive-post-title" href= "/2021/10/01/PHP-Audit-Day01-in-array-%E5%87%BD%E6%95%B0%E7%BC%BA%E9%99%B7/" >PHP-Audit Day01 in_array()函数缺陷</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/20</span><a class="archive-post-title" href= "/2021/09/20/%E6%9F%90%E5%B9%B3%E5%8F%B0%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E8%AE%B0%E5%BD%95/" >某平台渗透测试记录</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/30</span><a class="archive-post-title" href= "/2021/08/30/bluecms-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/" >bluecms-代码审计学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">08/12</span><a class="archive-post-title" href= "/2021/08/12/sql%E6%B3%A8%E5%85%A5-%E5%AE%89%E5%85%A8%E7%8B%97%E7%BB%95%E8%BF%87/" >sql注入-安全狗绕过</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/24</span><a class="archive-post-title" href= "/2021/04/24/Interview4/" >Interview4</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/23</span><a class="archive-post-title" href= "/2021/04/23/Windows%E8%AE%A4%E8%AF%81-Kerberos/" >Windows认证-Kerberos</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/08</span><a class="archive-post-title" href= "/2021/04/08/2021-HW/" >2021-HW</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/06</span><a class="archive-post-title" href= "/2021/04/06/Windows%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6%E5%AD%A6%E4%B9%A0/" >Windows认证机制学习</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">04/01</span><a class="archive-post-title" href= "/2021/04/01/%E4%B8%80%E6%AC%A1%E7%AE%80%E5%8D%95%E7%9A%84%E6%9D%80%E7%8C%AA%E7%9B%98getshell/" >一次简单的杀猪盘getshell</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/27</span><a class="archive-post-title" href= "/2021/03/27/Interview3/" >Interview3.md</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/27</span><a class="archive-post-title" href= "/2021/03/27/CVE-2021-22986-POC/" >CVE-2021-22986-POC</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/24</span><a class="archive-post-title" href= "/2021/03/24/%E5%9B%BD%E5%86%85%E6%9F%90%E7%B3%BB%E7%BB%9F%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/" >国内某系统任意文件读取漏洞</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/17</span><a class="archive-post-title" href= "/2021/03/17/%E5%AF%B9%E6%9F%90%E6%A3%8B%E7%89%8C%E7%AB%99%E7%9A%84%E4%B8%80%E6%AC%A1getshell/" >对某棋牌站的一次getshell</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/13</span><a class="archive-post-title" href= "/2021/03/13/%E9%80%9A%E8%BE%BEOA-v11-7-%E5%9C%A8%E7%BA%BF%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E/" >通达OA v11.7 在线用户登录漏洞</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/08</span><a class="archive-post-title" href= "/2021/03/08/CNVD-2021-14536-POC/" >CNVD-2021-14536-POC</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/06</span><a class="archive-post-title" href= "/2021/03/06/php-bugs/" >php_bugs</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">03/02</span><a class="archive-post-title" href= "/2021/03/02/Interview2/" >Interview2</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/22</span><a class="archive-post-title" href= "/2021/02/22/C-Notes/" >C_Notes</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/09</span><a class="archive-post-title" href= "/2021/02/09/CVE-2020-17518-17519%E5%A4%8D%E7%8E%B0/" >CVE-2020-17518/17519复现</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/03</span><a class="archive-post-title" href= "/2021/02/03/%E5%AF%B9%E6%9F%90BC%E7%AB%99%E7%9A%84%E4%B8%80%E6%AC%A1%E4%B8%8D%E5%AE%8C%E6%95%B4%E6%B8%97%E9%80%8F/" >对某BC站的一次不完整渗透</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/02</span><a class="archive-post-title" href= "/2021/02/02/%E5%B8%B8%E8%A7%81CMS%E5%90%8E%E5%8F%B0%E6%94%B6%E9%9B%86/" >常见CMS后台收集</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">02/01</span><a class="archive-post-title" href= "/2021/02/01/sqlmap-%E8%AE%B0%E5%BD%95/" >sqlmap 基本用法</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">01/31</span><a class="archive-post-title" href= "/2021/01/31/Interview/" >InterView</a>
        </li>
    
    
    
    
    
        </ul>
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/09</span><a class="archive-post-title" href= "/2019/09/09/CVE-2019-0708-%E5%A4%8D%E7%8E%B0/" >CVE-2019-0708 复现</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/08</span><a class="archive-post-title" href= "/2019/09/08/hello-world/" >Hello World</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="HW"><span class="iconfont-archer">&#xe606;</span>HW</span>
    
        <span class="sidebar-tag-name" data-tags="CVE"><span class="iconfont-archer">&#xe606;</span>CVE</span>
    
        <span class="sidebar-tag-name" data-tags="Tools"><span class="iconfont-archer">&#xe606;</span>Tools</span>
    
        <span class="sidebar-tag-name" data-tags="learn"><span class="iconfont-archer">&#xe606;</span>learn</span>
    
        <span class="sidebar-tag-name" data-tags="Struts"><span class="iconfont-archer">&#xe606;</span>Struts</span>
    
        <span class="sidebar-tag-name" data-tags="Python"><span class="iconfont-archer">&#xe606;</span>Python</span>
    
        <span class="sidebar-tag-name" data-tags="Windows"><span class="iconfont-archer">&#xe606;</span>Windows</span>
    
        <span class="sidebar-tag-name" data-tags="code"><span class="iconfont-archer">&#xe606;</span>code</span>
    
        <span class="sidebar-tag-name" data-tags="InterView"><span class="iconfont-archer">&#xe606;</span>InterView</span>
    
        <span class="sidebar-tag-name" data-tags="Learn"><span class="iconfont-archer">&#xe606;</span>Learn</span>
    
        <span class="sidebar-tag-name" data-tags="PHP"><span class="iconfont-archer">&#xe606;</span>PHP</span>
    
        <span class="sidebar-tag-name" data-tags="Audit"><span class="iconfont-archer">&#xe606;</span>Audit</span>
    
        <span class="sidebar-tag-name" data-tags="Pentest"><span class="iconfont-archer">&#xe606;</span>Pentest</span>
    
        <span class="sidebar-tag-name" data-tags="ThinkPHP"><span class="iconfont-archer">&#xe606;</span>ThinkPHP</span>
    
        <span class="sidebar-tag-name" data-tags="RCE"><span class="iconfont-archer">&#xe606;</span>RCE</span>
    
        <span class="sidebar-tag-name" data-tags="Sql"><span class="iconfont-archer">&#xe606;</span>Sql</span>
    
        <span class="sidebar-tag-name" data-tags="Windows认证"><span class="iconfont-archer">&#xe606;</span>Windows认证</span>
    
        <span class="sidebar-tag-name" data-tags="Kerberos"><span class="iconfont-archer">&#xe606;</span>Kerberos</span>
    
        <span class="sidebar-tag-name" data-tags="sqlmap"><span class="iconfont-archer">&#xe606;</span>sqlmap</span>
    
        <span class="sidebar-tag-name" data-tags="sql"><span class="iconfont-archer">&#xe606;</span>sql</span>
    
        <span class="sidebar-tag-name" data-tags="POC"><span class="iconfont-archer">&#xe606;</span>POC</span>
    
        <span class="sidebar-tag-name" data-tags="Work"><span class="iconfont-archer">&#xe606;</span>Work</span>
    
        <span class="sidebar-tag-name" data-tags="OA"><span class="iconfont-archer">&#xe606;</span>OA</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="POC"><span class="iconfont-archer">&#xe60a;</span>POC</span>
    
        <span class="sidebar-category-name" data-categories="CVE"><span class="iconfont-archer">&#xe60a;</span>CVE</span>
    
        <span class="sidebar-category-name" data-categories="Audit"><span class="iconfont-archer">&#xe60a;</span>Audit</span>
    
        <span class="sidebar-category-name" data-categories="CVE/EXP"><span class="iconfont-archer">&#xe60a;</span>CVE/EXP</span>
    
        <span class="sidebar-category-name" data-categories="CVE/POC"><span class="iconfont-archer">&#xe60a;</span>CVE/POC</span>
    
        <span class="sidebar-category-name" data-categories="C"><span class="iconfont-archer">&#xe60a;</span>C</span>
    
        <span class="sidebar-category-name" data-categories="Audit/Java"><span class="iconfont-archer">&#xe60a;</span>Audit/Java</span>
    
        <span class="sidebar-category-name" data-categories="learn"><span class="iconfont-archer">&#xe60a;</span>learn</span>
    
        <span class="sidebar-category-name" data-categories="Audit/PHP"><span class="iconfont-archer">&#xe60a;</span>Audit/PHP</span>
    
        <span class="sidebar-category-name" data-categories="Vul"><span class="iconfont-archer">&#xe60a;</span>Vul</span>
    
        <span class="sidebar-category-name" data-categories="Tips"><span class="iconfont-archer">&#xe60a;</span>Tips</span>
    
        <span class="sidebar-category-name" data-categories="内网学习"><span class="iconfont-archer">&#xe60a;</span>内网学习</span>
    
        <span class="sidebar-category-name" data-categories="tools"><span class="iconfont-archer">&#xe60a;</span>tools</span>
    
        <span class="sidebar-category-name" data-categories="bypass"><span class="iconfont-archer">&#xe60a;</span>bypass</span>
    
        <span class="sidebar-category-name" data-categories="POC/YAKIT"><span class="iconfont-archer">&#xe60a;</span>POC/YAKIT</span>
    
        <span class="sidebar-category-name" data-categories="Pentest"><span class="iconfont-archer">&#xe60a;</span>Pentest</span>
    
        <span class="sidebar-category-name" data-categories="0Day"><span class="iconfont-archer">&#xe60a;</span>0Day</span>
    
        <span class="sidebar-category-name" data-categories="mark"><span class="iconfont-archer">&#xe60a;</span>mark</span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "S1xHcL"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
     
    </body>
</html>


